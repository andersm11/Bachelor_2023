import numpy as np
from sklearn.decomposition import PCA
import math
import patch_manager as pmang
from skimage import io

X = io.imread('C:\\Users\\Blomst\\sperm_0p2_70hz_6t_00064.BTF')
X = X[200]
X = X[3]


def find_min_and_max(data):
    vector = data.reshape(-1)
    min=255
    max=0
    for elem in vector:
        if(min > elem): min = elem
        if(max < elem): max = elem
    return (min, max)


def change_range(vector, min, max, new_min, new_max):
    for i in range(len(vector)):
        vector[i] = (vector[i]-min)/(max - min ) * new_max
    return vector



test = [104,101,108,101,102,103,102,103,103,101,103,106,108,101,102,101,103,104,103,104,99,111,112,114,117,113,103,104,106,107,98,99,101,103,98,104,104,103,105,104,99,101,107,106,106,101,106,106,109,110,114,115,110,108,116,106,108,105,103,109,102,101,104,104,104,100,98,107,105,102,102,106,103,101,106,109,100,104,117,111,110,128,117,119,110,101,103,104,102,104,102,101,101,107,101,103,105,101,106,106,104,100,103,108,102,115,108,116,102,126,121,131,123,114,102,110,103,104,105,101,103,101,108,104,101,104,102,103,102,104,108,104,101,108,110,106,116,127,133,122,116,120,74,115,110,104,97,106,101,107,104,106,110,99,104,106,104,100,106,109,104,101,105,112,118,115,112,129,133,135,133,123,122,125,112,113,103,107,109,108,97,97,104,102,98,99,101,109,105,101,110,110,107,120,123,125,140,116,117,113,121,117,132,123,110,108,109,104,107,101,103,103,104,104,105,106,102,108,92,104,99,120,109,109,117,122,119,121,120,107,123,118,120,113,113,104,110,106,104,104,106,92,106,108,104,101,103,108,105,113,105,120,115,120,129,132,111,114,128,122,105,111,119,106,120,108,103,99,104,107,102,104,104,107,104,106,101,98,104,112,116,133,110,127,128,127,113,121,131,134,120,117,124,113,113,108,107,101,104,106,101,105,101,97,102,99,113,107,109,117,110,136,130,110,125,127,117,128,127,114,125,111,103,108,105,108,103,100,101,100,103,101,102,107,101,104,109,103,118,120,133,112,125,126,134,131,119,126,121,119,125,108,113,108,115,108,104,106,100,102,104,101,106,106,111,106,107,107,116,141,110,123,122,120,133,124,124,111,114,110,118,121,109,111,99,100,100,106,111,108,107,102,105,108,106,106,111,113,135,120,135,122,128,122,122,114,124,116,124,122,110,111,109,113,106,104,101,110,108,107,101,110,113,106,110,120,112,117,130,122,120,127,120,124,134,114,131,128,105,113,121,107,114,108,104,120,106,103,110,107,112,110,107,104,116,110,115,103,116,127,135,124,121,119,127,106,115,121,109,110,112,106,114,110,105,112,117,101,108,102,99,113,109,108,114,108,135,112,136,132,123,127,117,112,125,113,117,118,113,110,115,114,115,108,111,101,101,107,104,103,103,98,113,122,121,116,134,128,119,118,119,128,100,120,110,120,110,105,110,113,114,103,113,99,102,110,101,106,106,99,99,109,124,116,122,131,118,127,140,127,113,113,122,117,116,117,118,123,110,119,123,111,104,114,104,102,102,106,104,101,106,115,109,115,128,133,134,136,136,119,112,118,116,119,113,116,123,116,110,124,117,105,110,110,106,107,104,106,102,105,115,114,122,122,129,120,131,128,124,119,117,122,115,119,123,115,113,105,105,109,103,110,104,104,102,109,100,105,106,101,113,114,117,122,121,114,115,114,116,131,116,123,125,117,114,117,106,106,110,108,109,104,106,106,102,94,106,104,106,101,103,108,134,129,133,129,128,136,120,122,113,117,111,117,108,110,113,104,104,115,109,104,101,104,104,103,108,97,103,102,103,111,120,119,137,124,124,114,118,122,117,102,124,112,104,112,100,107,107,106,100,95,96,99,105,104,103,104,104,101,105,115,120,119,135,120,111,123,107,111,116,109,106,110,104,116,104,97,114,107,106,104,106,101,99,103,103,120,103,99,109,107,126,116,120,122,115,112,100,105,108,99,109,116,120,110,99,101,101,105,104,96,102,101,100,101,102,108,101,101,101,123,115,125,119,115,115,101,106,114,105,108,104,103,104,110,105,104,102,106,108,97,101,104,108,101,103,102,109,104,106,104,114,110,109,113,118,105,107,104,108,110,105,110,106,101,103,106,108,99,106,104,111,101,104,110,103,102,100,107,103,103,111,108,101,108,106,111,106,106,112,101,103,102,103,106,106,103,104,99,99,105,102,103,107,106,101,104,103,101,114,105,108,105,104,104,104,104,102,101,110,105,110,103,104,108,102,101,99,108,104,99,100,102,101,106,102,99,111,102]
test = np.array(test)

print(len(test))

org = pmang.patch_2_vec(X)

min, max =  find_min_and_max(org)

print(min)
print(max)
new = change_range(org, min, max, 0, 255)

min, max =  find_min_and_max(new)
print(min)
print(max)

patch = pmang.vec_2_patch(new, 400)
pmang.save_patch_as_image(patch, "c:\\Users\\Blomst\\full-scale.png")